<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <!-- Add Bootstrap CSS link here -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"></head>
<body>
    <div class="container mt-4 mb-5">
        <!-- Upload CSV Form -->
        <h3>Upload HTML to ElasticSearch Index</h3>
        
        <form id="uploadForm" action="/upload-html" method="post" enctype="multipart/form-data">
            <div class="input-group mt-3 mb-3"> 
                <input type="file" class="form-control" id="file" name="file" accept=".html" required aria-describedby="inputGroupFileAddon04" aria-label="Upload">
              </div>
            <button type="submit" class="btn btn-success">Upload and Compile</button>
            <button type="button" class="btn btn-primary" onclick="uploadCSV()">Upload CSV</button>

        </form>

        {% if csv_data %}
        <div id="pagination" class="mt-3 mb-3">
            <button class="btn btn-primary" onclick="prevPage()">Previous</button>
            <span id="currentPage">1</span>
            /
            <span id="totalPages">1</span>
            <button class="btn btn-primary" onclick="nextPage()">Next</button>
        </div>

        <!-- CSV Preview Table -->
        <table class="table" id="csvTable">
            <thead>
                <tr>
                    <th>{{ csv_data[0][0]}}</th>
                    <th>{{ csv_data[0][1]}}</th>
                    <th>{{ csv_data[0][2]}}</th>
                    <th>{{ csv_data[0][3]}}</th>
                    <th>{{ csv_data[0][4]}}</th>
                    <th>{{ csv_data[0][5]}}</th>
                    <th>{{ csv_data[0][6]}}</th>
                    <th>{{ csv_data[0][7]}}</th>
                    <th>{{ csv_data[0][8]}}</th>

                </tr>
            </thead>
            <tbody>
                {% for row in csv_data[1:] %}
                    <tr>
                        <td>{{ row[0] }}</td>
                        <td>{{ row[1] }}</td>
                        <td>{{ row[2] }}</td>
                        <td>{{ row[3] }}</td>
                        <td>{{ row[4] }}</td>
                        <td>{{ row[5] }}</td>
                        <td>{{ row[6] }}</td>
                        <td>{{ row[7] }}</td>
                        <td>{{ row[8] }}</td>

                    </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

    
    </div>
        
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    
    <script>
        function uploadCSV() {
            // Get the CSV data from the table
            const csvData = tableToCSV(document.getElementById('csvTable'));
            // Create a Blob object to hold the CSV data
            const blob = new Blob([csvData], { type: 'text/csv' });

            // Create a FormData object and append the Blob
            const formData = new FormData();
            formData.append('file', blob, 'csv_data.csv');

            // Use fetch to send the FormData to the server
            fetch('/upload-csv', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to upload CSV');
                }
                return response.json();
            })
            .then(data => {
                // Handle success, if needed
                console.log(data);
            })
            .catch(error => {
                // Handle error, if needed
                console.error(error);
            });
        }

       
    </script>
    
    <script>
        // JavaScript for pagination
        const itemsPerPage = 10;
        let currentPage = 1;
    
        function showPage(pageNumber) {
            const tableRows = document.querySelectorAll('#csvTable tbody tr');
            const totalPages = Math.ceil(tableRows.length / itemsPerPage);
            
            // Update current page and total pages in the UI
            currentPage = Math.min(Math.max(1, pageNumber), totalPages);
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;
    
            // Hide all rows
            tableRows.forEach(row => row.style.display = 'none');
    
            // Calculate start and end indices for the current page
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(currentPage * itemsPerPage, tableRows.length);
    
            // Show rows for the current page
            for (let i = startIndex; i < endIndex; i++) {
                tableRows[i].style.display = '';
            }
        }
    
        function prevPage() {
            showPage(currentPage - 1);
        }
    
        function nextPage() {
            showPage(currentPage + 1);
        }
    
        // Show the initial page when the page loads
        showPage(currentPage);
    </script>
</body>
</html>
